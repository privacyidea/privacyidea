<div
  aria-label="Content Layout"
  class="max-width-96 padding-32">
  <div class="audit-table-container">
    <div class="filter-paginator-container">
      <mat-form-field
        class="token-table-filter"
        subscriptSizing="dynamic">
        <mat-label>Enter Filter</mat-label>
        <app-clearable-input
          (onClick)="filterValueString.set('')"
          [showClearButton]="filterValueString().length > 0">
          <input
            #filterHTMLInputElement
            [(ngModel)]="filterValueString"
            aria-label="Filter Input"
            matInput
            placeholder="Example query: 'type: hotp userid: 1000'" />
        </app-clearable-input>
      </mat-form-field>
      <mat-paginator
        (page)="onPageEvent($event)"
        [length]="totalLength()"
        [pageIndex]="auditService.pageIndex()"
        [pageSizeOptions]="pageSizeOptions()"
        [pageSize]="auditService.pageSize()"
        showFirstLastButtons></mat-paginator>
    </div>
    <app-keyword-filter
      [advancedApiFilter]="auditService.advancedApiFilter"
      [apiFilter]="auditService.apiFilter"
      [filterHTMLInputElement]="filterHTMLInputElement"
      [filterValue]="auditService.filterValue"></app-keyword-filter>
    <table
      [dataSource]="auditDataSource()"
      aria-label="Audit Data Table"
      class="token-table"
      mat-table>
      @for (column of columnKeysMap; track column) {
        <ng-container [matColumnDef]="column.key">
          <th
            *matHeaderCellDef
            attr.aria-label="{{ column.label }} Header"
            mat-header-cell>
            {{ column.label }}
          </th>
          <td
            *matCellDef="let element; let row"
            attr.aria-label="{{ column.label }} Cell"
            mat-cell
            [ngClass]="{
              'width-18rem': column.key === 'description',
              'table-checkbox': column.key === 'select'
            }">
            <div>
              @switch (column.key) {
                @case ("success") {
                  <div class="flex just-center">
                    <span
                      [ngClass]="
                        tableUtilsService.getSpanClassForKey({
                          key: column.key,
                          value: element[column.key]
                        })
                      ">
                      {{ element[column.key] }}
                    </span>
                  </div>
                }
                @case ("serial") {
                  <div class="flex-row ali-center">
                    <a
                      attr.aria-label="{{ column.label }} Link"
                      (click)="contentService.tokenSelected(element.serial)"
                      routerLink="/token">
                      {{ element[column.key] }}
                    </a>
                    @if (element.serial && element.serial !== "") {
                      <app-copy-button [copyText]="element.serial"></app-copy-button>
                    }
                  </div>
                }
                @case (column.key === "sig_check" || column.key === "missing_line" ? column.key : "") {
                  <span [ngClass]="[element[column.key] === 'OK' ? 'highlight-true' : 'highlight-false']">
                    {{ element[column.key] }}
                  </span>
                }
                @case ("container_serial") {
                  <div class="flex-row ali-center">
                    <a
                      attr.aria-label="{{ column.label }} Link"
                      (click)="contentService.containerSelected(element.container_serial)"
                      routerLink="/token">
                      {{ element[column.key] }}
                    </a>
                    @if (element.container_serial && element.container_serial !== "") {
                      <app-copy-button [copyText]="element.container_serial"></app-copy-button>
                    }
                  </div>
                }
                @case ("startdate") {
                  <span>
                    {{ element[column.key].split(".")[0].replace("T", " ") }}
                  </span>
                }
                @case ("date") {
                  <span>
                    {{ element[column.key].split(".")[0].replace("T", " ") }}
                  </span>
                }
                @case ("policies") {
                  @for (policy of element[column.key]?.split(","); track policy) {
                    <span>
                      {{ policy }}
                    </span>
                  }
                }
                @default {
                  <span>
                    {{ element[column.key] }}
                  </span>
                }
              }
            </div>
          </td>
        </ng-container>
      }
      <tr
        *matHeaderRowDef="columnKeys"
        aria-label="Header Row"
        mat-header-row></tr>
      <tr
        *matRowDef="let row; columns: columnKeys"
        aria-label="Data Row"
        mat-row></tr>
      <tr
        *matNoDataRow
        aria-label="No Data Row">
        <td
          [attr.colspan]="columnKeys.length"
          aria-label="No Data Cell">
          No data matching the filter.
        </td>
      </tr>
    </table>
  </div>
</div>
