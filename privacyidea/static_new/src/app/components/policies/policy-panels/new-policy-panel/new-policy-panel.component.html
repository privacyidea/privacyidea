<div class="policy-card">
  <mat-expansion-panel
    #panel
    class="margin-4"
    [disabled]="
      policyService.viewMode() === 'new' || (policyService.isPolicyEdited() && policyService.viewMode() === 'edit')
    "
    (opened)="policyService.initializeNewPolicy()"
    (closed)="policyService.deselectPolicy(newPolicyName())">
    <mat-expansion-panel-header>
      <mat-panel-title>
        @if (panel.expanded) {
          <input
            type="text"
            class="policy-name-input"
            placeholder="Policy Name"
            [ngModel]="newPolicyName()"
            (ngModelChange)="onNameChange($event)"
            (click)="$event.stopPropagation(); panel.expanded = true"
            (keydown)="$event.stopPropagation()" />
        } @else {
          @if (!newPolicyName()) {
            <p i18n>New Policy</p>
          } @else {
            {{ newPolicyName() }}
          }
        }
      </mat-panel-title>
      <mat-panel-description class="header-description">
        <div class="policy-scope-label">
          @if (!this.policyService.selectedPolicyHasActions() && panel.expanded) {
            <app-horizontal-wheel
              [initialValue]="newPolicyScope()"
              [values]="policyService.allPolicyScopes"
              (onSelect)="onScopeSelect($event)" />
          } @else {
            <span>
              {{ newPolicyScope().toLocaleUpperCase() }}
            </span>
          }
        </div>
        <div class="policy-actions">
          @if (panel.expanded) {
            <button
              mat-icon-button
              [disabled]="!canSavePolicy()"
              (click)="$event.stopPropagation(); savePolicy(panel)">
              <mat-icon>save</mat-icon>
            </button>
            <button
              mat-icon-button
              (click)="$event.stopPropagation(); resetPolicy(panel)">
              <mat-icon>close</mat-icon>
            </button>
          }
        </div>
      </mat-panel-description>
    </mat-expansion-panel-header>

    <div class="policy-grid-container">
      <div class="tab-buttons">
        <button
          mat-flat-button
          [ngClass]="activeTab() === 'actions' ? 'tab-button-active' : 'tab-button'"
          (click)="setActiveTab('actions')">
          ACTIONS
        </button>
        <button
          mat-flat-button
          [ngClass]="activeTab() === 'conditions' ? 'tab-button-active' : 'tab-button'"
          (click)="setActiveTab('conditions')">
          CONDITIONS
        </button>
      </div>
      @if (activeTab() === "actions") {
        <app-selected-actions-list class="grid-area-content-header" />
        <app-action-selector class="grid-area-content-body" />
        <app-policy-description class="grid-area-detail-header" />
        <app-action-detail class="grid-area-detail-body" />
      }
    </div>
  </mat-expansion-panel>
</div>
