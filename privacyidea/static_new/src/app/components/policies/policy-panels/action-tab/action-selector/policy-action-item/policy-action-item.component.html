<!--
 (c) NetKnights GmbH 2026,  https://netknights.it

 This code is free software; you can redistribute it and/or
 modify it under the terms of the GNU AFFERO GENERAL PUBLIC LICENSE
 as published by the Free Software Foundation; either
 version 3 of the License, or any later version.

 This code is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 GNU AFFERO GENERAL PUBLIC LICENSE for more details.

 You should have received a copy of the GNU Affero General Public
 License along with this program.  If not, see <http://www.gnu.org/licenses/>.

 SPDX-License-Identifier: AGPL-3.0-or-later
-->
<div
  class="policy-action-item"
  [class.policy-action-item-selected]="isSelected()"
  (click)="selectActionByName.emit(actionName())">
  <span class="detail-label">{{ actionName() }}</span>

  <div class="detail-input">
    @if (actionDetail()?.value; as actionValues) {
      @if (actionValues.length === 0) {
        <p i18n>No values available for this action.</p>
      } @else if (actionValues.length <= 3) {
        <app-selector-buttons
          #buttonElement
          [class]="actionValues.length === 1 ? 'half-width' : 'full-width'"
          [values]="actionDetail()?.value!"
          (onSelect)="addAction($event)" />
      } @else {
        <mat-form-field
          appearance="fill"
          class="full-width"
          subscriptSizing="dynamic">
          <mat-select
            #selectElement
            (selectionChange)="addAction($event.value)">
            @for (option of actionDetail()?.value; track option) {
              <mat-option [value]="option">{{ option }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      }
    } @else {
      @switch (actionDetail()?.type) {
        @case ("str") {
          <input
            #inputElement
            type="text"
            class="action-value-input"
            [ngModel]="currentAction().value"
            (ngModelChange)="updateSelectedActionValue($event)"
            (keydown.enter)="addAction()" />
        }
        @case ("int") {
          <input
            #inputElement
            type="number"
            class="action-value-input"
            [ngModel]="currentAction().value"
            (ngModelChange)="updateSelectedActionValue($event)"
            (keydown.enter)="addAction()" />
        }
        @case ("text") {
          <textarea
            #inputElement
            class="action-value-textarea"
            [ngModel]="currentAction().value"
            (ngModelChange)="updateSelectedActionValue($event)"></textarea>
        }
      }
      <button
        #buttonElement
        mat-icon-button
        class="add-action-button half-width"
        [disabled]="!inputIsValid()"
        (click)="$event.stopPropagation(); addAction()">
        <mat-icon>add</mat-icon>
      </button>
    }
  </div>

  <span class="detail-description">{{ actionDetail()?.desc }}</span>
</div>
