<!--
 (c) NetKnights GmbH 2025,  https://netknights.it

 This code is free software; you can redistribute it and/or
 modify it under the terms of the GNU AFFERO GENERAL PUBLIC LICENSE
 as published by the Free Software Foundation; either
 version 3 of the License, or any later version.

 This code is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 GNU AFFERO GENERAL PUBLIC LICENSE for more details.

 You should have received a copy of the GNU Affero General Public
 License along with this program.  If not, see <http://www.gnu.org/licenses/>.

 SPDX-License-Identifier: AGPL-3.0-or-later
-->
<div
  aria-label="User Details Container Table"
  class="user-details-container-table-layout"
  i18n-aria-label>

  <div class="details-header">
    <h3 i18n>Containers of User</h3>
    <h3 class="username-header">{{ userService.detailsUsername() }}</h3>
    <h3 class="margin-left--8">:</h3>
  </div>
  <div class="flex-row filter-paginator-container">
    <mat-form-field
      class="width-50"
      subscriptSizing="dynamic">
      <mat-label i18n>Filter Containers...</mat-label>
      <app-clearable-input
        (onClick)="filterValue=''; dataSource.filter=''"
        [showClearButton]="filterValue.length > 0">
        <input
          (keyup)="handleFilterInput($event)"
          aria-label="Filter Input"
          i18n-aria-label
          i18n-placeholder
          matInput
          placeholder="Filter across all columns." />
      </app-clearable-input>
    </mat-form-field>
  <mat-paginator
    [pageSizeOptions]="pageSizeOptions()"
    [pageSize]="pageSize"
    class="flex-just-start"
    showFirstLastButtons></mat-paginator>
  </div>
  <div class="table-wrapper">
    <table
      [dataSource]="dataSource"
      aria-label="Containers for Selected User"
      class="user-details-container-table"
      i18n-aria-label
      mat-table
      matSort
      matSortDisableClear="false">

      @for (column of columnsKeyMap; track column) {
        <ng-container [matColumnDef]="column.key">
          <th
            *matHeaderCellDef
            attr.aria-label="{{ column.label }} Header"
            mat-header-cell
            mat-sort-header>
            {{ column.label }}
          </th>

          <td
            *matCellDef="let element"
            [ngClass]="{ 'width-18rem': column.key === 'description' }"
            attr.aria-label="{{ column.label }} Cell"
            mat-cell>

            <div [ngClass]="tableUtilsService.getClassForColumnKey(column.key)">
              @switch (column.key) {
                @case ("serial") {
                  <a
                    (click)="contentService.containerSelected(element.serial)"
                    attr.aria-label="{{ column.label }} Link">
                    {{ element.serial }}
                  </a>
                  @if (element.serial !== "") {
                    <app-copy-button [copyText]="element.serial"></app-copy-button>
                  }
                }
                @case ("states") {
                  <span
                    (click)="handleStateClick(element)"
                    [matTooltip]="tableUtilsService.getTooltipForColumn('states', element)"
                    [ngClass]="tableUtilsService.getSpanClassForState(element.states?.[0], true)">
                    {{ tableUtilsService.getDisplayTextForState(element.states?.[0]) }}
                  </span>
                }
                @case ("realms") {
                  <div [ngClass]="{ 'realm-list': (element.realms?.length || 0) > 1 }">
                    @for (realm of element.realms; track realm) {
                      <div>{{ realm }}</div>
                    }
                  </div>
                }
                @default {
                  <span>{{ element[column.key] }}</span>
                }
              }
            </div>

          </td>
        </ng-container>
      }

      <tr
        *matHeaderRowDef="displayedColumns"
        mat-header-row></tr>
      <tr
        *matRowDef="let row; columns: displayedColumns"
        mat-row></tr>

      <tr *matNoDataRow>
        <td
          [attr.colspan]="displayedColumns.length"
          i18n>
          No data matching the filter.
        </td>
      </tr>
    </table>
  </div>
</div>