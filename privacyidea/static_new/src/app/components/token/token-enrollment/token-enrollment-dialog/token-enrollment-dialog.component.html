<h2 mat-dialog-title>Token successfully enrolled</h2>
<mat-dialog-content>
  @if (!data.response.detail?.pushurl || data.pushEnrolled()) {
    <p>
      <span>The token was successfully enrolled with serial number
      <a (click)="tokenSelected(data.response.detail.serial)"> {{ data.response.detail.serial }}
      </a>.</span>
      @if (data.response.detail.container_serial) {
        <br><span>It has been enrolled in the container
        <a (click)="containerSelected(data.response.detail.container_serial)"> {{
            data.response.detail.container_serial
          }} </a>.</span>
      }
      @if (data.username != '' && data.userRealm != '' && !data.onlyAddToRealm) {
        <br><span>The user <a href="#">{{ data.username }}</a> in the realm <a href="#">{{
            data.userRealm
          }}</a> was assigned to the token.
        </span>
      }
    </p>
  }
  <div class="flex-row gap-1">
    @if (data.response.detail?.googleurl?.img) {
      <img alt="QR Code"
           class="qr-code"
           height="300px"
           src="{{ data.response.detail.googleurl.img }}"
           width="300px" />
    } @else if (data.response.detail?.motpurl?.img) {
      <img alt="QR Code"
           class="qr-code"
           height="300px"
           src="{{ data.response.detail.motpurl.img }}"
           width="300px" />
    } @else if (data.response.detail?.otpkey?.img) {
      <img alt="QR Code"
           class="qr-code"
           height="300px"
           src="{{ data.response.detail.otpkey.img }}"
           width="300px" />
    } @else if (data.response.detail?.pushurl?.img && !data.pushEnrolled()) {
      <img alt="QR Code"
           class="qr-code"
           height="300px"
           src="{{ data.response.detail.pushurl.img }}"
           width="300px" />
    } @else if (data.response.detail?.tiqrenroll?.img) {
      <img alt="QR Code"
           class="qr-code"
           height="300px"
           src="{{ data.response.detail.tiqrenroll.img }}"
           width="300px" />
    }
    <div class="flex-column gap-1">
      @let url = data.response.detail?.googleurl?.value ?? data.response.detail?.motpurl?.value
        ?? data.response.detail?.otpkey?.value ?? data.response.detail?.tiqrenroll?.value;
      @if (url) {
        <p class="qr-code-text">
          Click <a href="{{ url }}">here</a> or scan the QR Code, if you want to add the Token to
          your smartphone authenticator app. The QR Code contains the secret key of your token. You
          need to protect it. <strong> If you are in doubt, that someone else saw it, please
          regenerate the QR Code, when no one else is watching. </strong>
        </p>

        <button (click)="regenerateQRCode()"
                class="card-button"
                mat-flat-button>
          <mat-icon>autorenew</mat-icon>
          Regenerate QR Code
        </button>
      }

      @if (data.response.detail?.password) {
        <p>
          Your Password: <strong>{{ data.response.detail.password }}</strong>. </p>
      }

      @if (data.response.detail?.pushurl && !data.pushEnrolled()) {
        <span>
          Your token with serial number {{ data.response.detail.serial }} is not completely
          enrolled, yet. <br>
        </span><span>
          Please scan the QR code with the privacyIDEA Authenticator App
          <br> or click <a href="{{data.response.detail.pushurl.value}}">this link</a>
          on your smartphone. <br>
          It will send the missing registration data to the configured endpoint.
        </span><span>
          Please note, that your smartphone needs internet access during the authentication process.
        </span>
      }

      @if (data.response.detail?.otpkey?.value && !data.response.detail?.otps) {
        <mat-accordion class="otpkey-expension">
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title> The OTP key</mat-panel-title>
            </mat-expansion-panel-header>
            <p class="otpkey-p">Hex: {{ data.response.detail.otpkey.value }}</p>
            @if (data.response.detail.otpkey.value_b32) {
              <p class="otpkey-p">Base32: {{ data.response.detail.otpkey.value_b32 }}</p>
            }
          </mat-expansion-panel>
        </mat-accordion>
      }

      @if (data.response.detail?.otps) {
        <mat-accordion class="otpkey-expension">
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title> The OTP values
                @if (data.response.detail?.otps) {
                  <button (click)="printOtps()"
                          mat-icon-button
                          class="margin-left-1">
                    <mat-icon>print</mat-icon>
                  </button>
                }
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div id="otp-values">
              <div class="otp-values">
                @for (otp of Object.entries(data.response.detail.otps); track otp) {
                  <span class="otp-value"> #{{ otp[0] }}: {{ otp[1] }}</span>
                }
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      }
    </div>
  </div>
  @if (data.response.detail?.u2fRegisterRequest) {
    <span>Take action on your token:</span><p class="max-width-600"> You need to confirm the
      registration with your token either by pushing the blinking button or by religging your token.
      This depends on the actual token model.</p>
  }

  @if (data.response.detail?.webAuthnRegisterRequest) {
    <span>Take action on your authenticator:</span><p class="max-width-600">You need to confirm the
      registration with your authenticator. For an external authenticator, this usually means
      pushing the button on the authenticator, or replugging it (if there is no button on the
      authenticator). If you want to use an authenticator that is integrated into your device, look
      for a dialog box from your operating system. If you do not see anything, please make sure that
      your authenticator supports WebAuthn. </p>
  }
</mat-dialog-content>

<mat-dialog-actions>
  <button mat-button
          mat-dialog-close>Close
  </button>
</mat-dialog-actions>
