<div
  #scrollContainer
  appScrollToTop
  aria-label="Create Container"
  class="container-create-container"
  i18n-aria-label>
  <h3
    class="margin-left-1"
    i18n>Create a New Container
  </h3>
  <div #stickySentinel></div>
  <div
    #stickyHeader
    class="sticky-header">
    <div class="sticky-controls ali-center">
      <div class="select-container-type">
        <mat-form-field
          class="width-100"
          subscriptSizing="dynamic">
          <mat-select
            [(ngModel)]="containerService.selectedContainerType"
            [ngModelOptions]="{ standalone: true }"
            [panelClass]="'single-column-panel'"
            [value]="containerService.selectedContainerType()">
            @for (type of containerService.containerTypeOptions(); track type) {
              <mat-option
                class="select-option"
                [value]="type">
                {{ type.description }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      <div class="enroll-button-container">
        <button
          (click)="createContainer()"
          class="action-button-1 width-238"
          mat-stroked-button
          i18n
          [disabled]="!validInput">
          <mat-icon>add</mat-icon>
          Create
        </button>
        <button
          (click)="reopenEnrollmentDialog()"
          [matTooltip]="'Reopen enrollment dialog'"
          [ngClass]="{ hidden: !registerResponse() }"
          mat-icon-button
          type="button">
          <mat-icon>open_in_new</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <div
    class="container-type-hint"
    i18n>
    Supported Token Types:
    @if (containerService.selectedContainerType().token_types.length >= tokenService.tokenTypeOptions().length) {
      All
    } @else if (containerService.selectedContainerType().token_types.length > 1) {
      {{ containerService.selectedContainerType().token_types.join(", ") }}
    } @else {
      {{ containerService.selectedContainerType().token_types[0] }}
    }
  </div>

  <mat-form-field class="width-66 margin-top-1">
    <mat-label i18n>Description</mat-label>
    <textarea
      [(ngModel)]="description"
      [maxlength]="80"
      i18n
      i18n-placeholder
      matInput
      placeholder="Enter description"
      rows="3"></textarea>
  </mat-form-field>

  <div class="flex-column width-100 gap-1">
    @if (authService.actionAllowed("container_template_list")) {
      <div class="flex-column width-66">
        <h4
          class="enroll-h4"
          i18n>Use a Template
        </h4>
        <mat-form-field class="width-100 input-height">
          <mat-label i18n>Template</mat-label>
          <mat-select
            [(ngModel)]="selectedTemplate"
            [value]="selectedTemplate()">
            <mat-option [value]="'-'">-</mat-option>
            @for (option of templateOptions(); track option) {
              <mat-option [value]="option.name">{{ option.name }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
    }
    <h4
      class="enroll-h4"
      i18n>Assign the Container to a User
    </h4>
    <div class="flex-row gap-1">
      <app-user-assignment
        [showOnlyAddToRealm]="true"></app-user-assignment>
    </div>
  </div>

  @if (containerService.selectedContainerType().containerType === "smartphone") {
    <h4
      i18n
      class="enroll-h4">
      Registration
    </h4>
    <mat-checkbox
      (change)="registrationSettings.expanded = false"
      [(ngModel)]="generateQRCode">
      Generate a QR code to register the container on a smartphone.
    </mat-checkbox>
    <mat-accordion>
      <mat-expansion-panel
        #registrationSettings
        [disabled]="!generateQRCode()"
        class="expansion-panel">
        <mat-expansion-panel-header>
          <mat-panel-title i18n> Optional Settings</mat-panel-title>
        </mat-expansion-panel-header>
        <app-container-registration-config
          [containerHasOwner]="userSelected()"
          [userStorePassphrase]="userStorePassphrase"
          [passphrasePrompt]="passphrasePrompt"
          [passphraseResponse]="passphraseResponse"
          (validInputChange)="onValidInputChange($event)">
        </app-container-registration-config>
      </mat-expansion-panel>
    </mat-accordion>
  }
</div>
