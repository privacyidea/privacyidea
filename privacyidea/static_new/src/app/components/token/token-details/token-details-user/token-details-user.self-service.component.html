<div
  [ngClass]="{
    'pad-0': overflowService.isWidthOverflowing('body', 1310)
  }"
  class="user-container">
  <table
    [dataSource]="userData()"
    aria-label="User Detail Data Table"
    class="user-details-table"
    mat-table>
    <ng-container matColumnDef="key">
      <td
        *matCellDef="let element"
        class="details-key-row"
        mat-cell>
        {{ element.keyMap.label }}
      </td>
    </ng-container>
    <ng-container matColumnDef="value">
      <td
        *matCellDef="let element"
        class="user-editable-row height-52 fix-width-20-padr-0"
        mat-cell>
        @switch (element.keyMap.key) {
          @case ("username") {
            @if (isEditingUser() && userService.selectedUserRealm() !== "") {
              <mat-form-field>
                <mat-label>Enter User</mat-label>
                <app-clearable-input
                  (onClick)="userService.userFilter.set('')"
                  [showClearButton]="userService.userFilter() !== ''">
                  <input
                    matInput
                    [(ngModel)]="userService.userFilter"
                    [matAutocomplete]="userAuto" />
                  <mat-autocomplete #userAuto="matAutocomplete">
                    @for (option of userService.filteredUsernames(); track option) {
                      <mat-option [value]="option">{{ option }}</mat-option>
                    }
                  </mat-autocomplete>
                </app-clearable-input>
              </mat-form-field>
            } @else {
              <span>{{ element.value }}</span>
            }
          }
          @case ("user_realm") {
            @if (isEditingUser()) {
              <mat-form-field>
                <mat-label>Select Realm of User</mat-label>
                <mat-select [(ngModel)]="userService.selectedUserRealm"
                            [value]="userService.selectedUserRealm()">
                  @for (option of realmService.realmOptions(); track option) {
                    <mat-option value="{{ option }}">{{ option }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            } @else {
              <span>{{ element.value }}</span>
            }
          }
          @default {
            {{ element.value }}
          }
        }
      </td>
    </ng-container>
    <ng-container matColumnDef="edit">
      <td
        *matCellDef="let element"
        class="edit-column-cell"
        mat-cell>
        @switch (element.keyMap.key) {
          @case ("username") {
            @if (!(isAnyEditingOrRevoked() && !isEditingUser())) {
              @if (element.value) {
                <div class="edit-button-container">
                  <button
                    mat-icon-button
                    class="yellow"
                    (click)="unassignUser()">
                    <mat-icon>person_remove</mat-icon>
                  </button>
                </div>
              } @else {
                <app-edit-buttons
                  [toggleEdit]="toggleUserEdit.bind(this)"
                  [saveEdit]="saveUser.bind(this)"
                  [cancelEdit]="cancelUserEdit.bind(this)"
                  [shouldHideEdit]="isAnyEditingOrRevoked"
                  [isEditingUser]="isEditingUser"
                  [isEditingInfo]="isEditingInfo"
                  [element]="element"></app-edit-buttons>
              }
            }
          }
        }
      </td>
    </ng-container>
    <tr
      *matRowDef="let row; columns: ['key', 'value', 'edit']"
      mat-row></tr>
  </table>
</div>
