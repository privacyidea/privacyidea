<!--
 (c) NetKnights GmbH 2026,  https://netknights.it

 This code is free software; you can redistribute it and/or
 modify it under the terms of the GNU AFFERO GENERAL PUBLIC LICENSE
 as published by the Free Software Foundation; either
 version 3 of the License, or any later version.

 This code is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 GNU AFFERO GENERAL PUBLIC LICENSE for more details.

 You should have received a copy of the GNU Affero General Public
 License along with this program.  If not, see <http://www.gnu.org/licenses/>.

 SPDX-License-Identifier: AGPL-3.0-or-later
-->

<div class="flex-row">
  <div class="flex-size-2 flex-column">
    <!--  Selected Conditions  -->
    <div class="selected-actions-container">
      @for (conditionName of Object.keys(selectedConditions()); track conditionName) {
        <div
          class="action-card"
          [class.action-card-selected]="clickedCondition() === conditionName"
          (click)="clickedCondition.set(conditionName)">
          <div class="action-card-row">
            <span class="action-label">{{ conditionName }}</span>
            @if (!isBooleanCondition(conditionName)) {
              <span class="action-value">{{ selectedConditions()[conditionName] }}</span>
            }
            @if (isEditMode()) {
              <div class="gap-div-8px"></div>
              <button
                mat-icon-button
                class="action-button"
                (click)="removeCondition(conditionName); $event.stopPropagation()">
                <mat-icon>delete</mat-icon>
              </button>
            }
          </div>
        </div>
      }
      @if (Object.keys(selectedConditions()).length === 0) {
        <div
          class="italic"
          i18n>
          No conditions selected.
        </div>
      }
    </div>
    @if (isEditMode()) {
      <!--   Add New Conditions (Selector)   -->
      <mat-divider class="margin-top-16 margin-bottom-16"></mat-divider>
      <div class="action-selector-container">
        <h4 class="margin-top-8 margin-bottom-8">Add new condition</h4>
        <!-- Search bar -->
        <mat-form-field
          subscriptSizing="dynamic">
          <mat-label i18n>Search condition ...</mat-label>
          <app-clearable-input
            (onClick)="searchTerm.set('')"
            [showClearButton]="searchTerm().length > 0">
            <input
              matInput
              type="text"
              placeholder="Search condition ..."
              [ngModel]="searchTerm()"
              (ngModelChange)="searchTerm.set($event)" />
          </app-clearable-input>
        </mat-form-field>
        <!-- Condition Groups -->
        <mat-tab-group animationDuration="0ms">
          @for (group of availableGroups(); track $index) {
            <mat-tab class="overflow-hidden" [disabled]="Object.keys(remainingConditionsByGroup()[group]).length === 0">
              <ng-template mat-tab-label>
                {{ group | titlecase }}
              </ng-template>
              <!-- Conditions in Group -->
              <div class="selected-actions-container">
                @for (conditionName of Object.keys(remainingConditionsByGroup()[group] || {}); track conditionName) {
                  <div
                    class="action-card"
                    [class.action-card-selected]="clickedCondition() === conditionName"
                    (click)="clickedCondition.set(conditionName)">
                    <span class="action-label">{{ conditionName }}</span>
                  </div>
                }
              </div>
            </mat-tab>
          }
        </mat-tab-group>
      </div>
    }
  </div>
  <!--   Condition Details (description and edit field)   -->
  <div class="flex-size-1">
    <app-event-condition-details
      [conditionName]="clickedCondition()"
      [originalConditionValue]="selectedConditions()[clickedCondition()]"
      [isEditMode]="isEditMode()"
      [isNewCondition]="Object.keys(selectedConditions()).indexOf(clickedCondition()) >= 0"
      (conditionSubmitted)="onConditionSubmitted($event)"></app-event-condition-details>
  </div>
</div>