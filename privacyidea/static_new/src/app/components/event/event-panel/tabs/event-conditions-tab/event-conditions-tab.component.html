<!--
 (c) NetKnights GmbH 2026,  https://netknights.it

 This code is free software; you can redistribute it and/or
 modify it under the terms of the GNU AFFERO GENERAL PUBLIC LICENSE
 as published by the Free Software Foundation; either
 version 3 of the License, or any later version.

 This code is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 GNU AFFERO GENERAL PUBLIC LICENSE for more details.

 You should have received a copy of the GNU Affero General Public
 License along with this program.  If not, see <http://www.gnu.org/licenses/>.

 SPDX-License-Identifier: AGPL-3.0-or-later
-->

<div class="conditions-container">
  <div class="condition-column">
    <!--   Add New Conditions   -->
    <mat-card>
      <mat-card-header>
        <div class="flex margin-bottom-8 gap-8">
          <mat-icon class="small-icon">add_circle</mat-icon>
          <h4
            class="margin-0"
            i18n>Add New Conditions
          </h4>
        </div>
      </mat-card-header>
      <mat-card-content>
        <div class="add-conditions-container">
          <!-- Search bar -->
          <mat-form-field
            subscriptSizing="dynamic">
            <mat-label i18n>Search condition ...</mat-label>
            <app-clearable-input
              (onClick)="searchTerm.set('')"
              [showClearButton]="searchTerm().length > 0">
              <input
                matInput
                type="text"
                placeholder="Search condition ..."
                [ngModel]="searchTerm()"
                (ngModelChange)="searchTerm.set($event)" />
            </app-clearable-input>
          </mat-form-field>
          <!-- Condition Groups -->
          <mat-tab-group
            #conditionTabs
            mat-stretch-tabs="false"
            [(selectedIndex)]="selectedGroupIndex"
            animationDuration="0ms">
            @for (group of availableGroups(); track $index) {
              <mat-tab
                class="overflow-hidden"
                [disabled]="Object.keys(remainingConditionsByGroup()[group]).length === 0">
                <ng-template mat-tab-label>
                  {{ group | titlecase }}
                </ng-template>
                <!-- Conditions in Group -->
                <div class="add-conditions-list-container">
                  <app-event-condition-list
                    [conditions]="remainingConditionsByGroup()[group]"
                    [action]="'add'"
                    [emitOnConditionValueChange]="false"
                    [actionOnEnter]="true"
                    [toolTipText]="addToolTip"
                    (newConditionValue)="onConditionValueToBeAddedChange($event.conditionName, $event.conditionValue)"
                    (actionButtonClicked)="onConditionValueChange($event.conditionName, $event.conditionValue)"></app-event-condition-list>
                </div>
              </mat-tab>
            }
          </mat-tab-group>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="condition-column">
    <!--  Selected Conditions  -->
    <mat-card>
      <mat-card-header>
        <div class="flex margin-bottom-8 gap-8">
          <mat-icon class="small-icon">settings</mat-icon>
          <h4
            class="margin-0"
            i18n>Configured Conditions
          </h4>
        </div>
      </mat-card-header>
      <mat-card-content>
        <div class="configured-conditions-list-container">
          <app-event-condition-list
            [conditions]="selectedConditions()"
            [action]="'delete'"
            [emitOnConditionValueChange]="true"
            [inputRequired]="true"
            [toolTipText]="removeToolTip"
            (newConditionValue)="onConditionValueChange($event.conditionName, $event.conditionValue)"
            [focusConditionName]="addedCondition()"
            (actionButtonClicked)="removeCondition($event.conditionName)"></app-event-condition-list>
          @if (Object.keys(selectedConditions()).length === 0) {
            <div
              class="italic"
              i18n>
              No conditions configured yet.
            </div>
          }
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>