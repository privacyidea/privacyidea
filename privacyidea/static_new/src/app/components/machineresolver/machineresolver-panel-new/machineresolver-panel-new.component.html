<!--
 (c) NetKnights GmbH 2025,  https://netknights.it

 This code is free software; you can redistribute it and/or
 modify it under the terms of the GNU AFFERO GENERAL PUBLIC LICENSE
 as published by the Free Software Foundation; either
 version 3 of the License, or any later version.

 This code is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 GNU AFFERO GENERAL PUBLIC LICENSE for more details.

 You should have received a copy of the GNU Affero General Public
 License along with this program.  If not, see <http://www.gnu.org/licenses/>.

 SPDX-License-Identifier: AGPL-3.0-or-later
-->

<div class="machineresolver-card">
  <mat-expansion-panel
    #panel
    class="margin-4"
    [disabled]="isEdited()"
    (closed)="handleCollapse(panel)">
    <mat-expansion-panel-header class="mat-expansion-panel-header">
      <mat-panel-title>
        @if (panel.expanded) {
          <input
            type="text"
            class="machineresolver-name-input"
            placeholder="Name"
            [ngModel]="newMachineresolver().resolvername"
            (ngModelChange)="onResolvernameChange($event)"
            (click)="$event.stopPropagation(); panel.expanded = true"
            (keydown)="$event.stopPropagation()" />
        } @else {
          <p i18n>New Machineresolver</p>
        }
      </mat-panel-title>
      <mat-panel-description class="header-description">
        <div class="machineresolver-type-label">
          @if (panel.expanded) {
            <mat-form-field
              appearance="fill"
              class="machineresolver-type-dropdown"
              (click)="$event.stopPropagation()">
              <mat-label i18n>Type</mat-label>
              <mat-select
                [value]="newMachineresolver().type"
                (selectionChange)="onMachineresolverTypeChange($event.value)">
                @for (machineresolverType of machineresolverTypes; track machineresolverType) {
                  <mat-option [value]="machineresolverType">{{ machineresolverType }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          }
        </div>
        <div class="machineresolver-actions">
          @if (panel.expanded) {
            <button
              mat-icon-button
              [disabled]="!canSaveMachineresolver()"
              (click)="$event.stopPropagation(); saveMachineresolver(panel)">
              <mat-icon>save</mat-icon>
            </button>
            <button
              mat-icon-button
              (click)="$event.stopPropagation(); handleCollapse(panel)">
              <mat-icon>close</mat-icon>
            </button>
          }
        </div>
      </mat-panel-description>
    </mat-expansion-panel-header>
    <div class="mat-expansion-panel-body">
      @switch (newMachineresolver().type) {
        @case ("hosts") {
          <app-machineresolver-hosts-tab
            [isEditMode]="true"
            [machineresolverData]="newMachineresolver().data"
            (onDataChange)="onDataChange($event)"
            (onValidatorChange)="onDataValidatorChange($event)" />
        }
        @case ("ldap") {}
        @default {
          <!-- Fallback for unknown types -->
          <p i18n>Unknown machine resolver type: {{ newMachineresolver().type }}</p>
        }
      }
    </div>
  </mat-expansion-panel>
</div>
