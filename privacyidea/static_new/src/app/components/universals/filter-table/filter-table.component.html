<div aria-label="Filter Table" class="filter-table">
  <div class="filter-paginator-container">
    <mat-form-field class="token-table-filter" subscriptSizing="dynamic">
      <mat-label>Enter Filter</mat-label>
      <input
        #input
        (keyup)="handleFilterInput($event)"
        aria-label="Filter Input"
        matInput
        placeholder="Example query: 'type: hotp userid: 1000'" />
    </mat-form-field>
    <mat-paginator
      (page)="handlePageEvent($event)"
      [length]="numItems"
      [pageIndex]="pageIndex"
      [pageSizeOptions]="pageSizeOptions"
      [pageSize]="pageSize"
      aria-label="Select page of tokens"
      showFirstLastButtons></mat-paginator>
  </div>
  <div class="filter-keyword-container">
    <div class="filter-keyword-title">
      <mat-icon class="filter-icon">filter_alt</mat-icon>
      Filter by:&nbsp;
    </div>
    @for (
      filterKeyword of showAdvancedFilter() ? allApiFilter : apiFilter;
      track filterKeyword
    ) {
      <button
        mat-fab
        extended
        (click)="toggleKeywordInFilter(filterKeyword, input)"
        class="keyword-button">
        <mat-icon
          class="keyword-button-icon"
          [ngClass]="
            {
              change_circle: 'change-keyword',
              remove_circle: 'remove-keyword',
              add_circle: 'add-keyword',
            }[tableUtilsService.getFilterIconName(filterKeyword, input.value)]
          ">
          {{ tableUtilsService.getFilterIconName(filterKeyword, input.value) }}
        </mat-icon>
        {{ filterKeyword }}
      </button>
    }
    @if (advancedApiFilter.length !== 0) {
      <button
        (click)="showAdvancedFilter.set(!showAdvancedFilter())"
        class="more-keyword-button"
        extended
        mat-fab>
        <mat-icon class="keyword-button-icon">
          {{ showAdvancedFilter() ? "remove" : "add" }}
        </mat-icon>
      </button>
    }
  </div>
  <table
    (matSortChange)="handleSortEvent()"
    [dataSource]="dataSource()"
    aria-label="Token Data Table"
    class="token-table"
    mat-table
    matSort>
    @for (column of columnsKeyMap; track column) {
      <ng-container [matColumnDef]="column.key">
        <th
          *matHeaderCellDef
          attr.aria-label="{{ column.label }} Header"
          mat-header-cell
          mat-sort-header>
          {{ column.label }}
        </th>
        <td
          *matCellDef="let element"
          attr.aria-label="{{ column.label }} Cell"
          mat-cell
          [ngClass]="{ 'width-18': column.key === 'description' }">
          <ng-container>
            <div [ngClass]="tableUtilsService.getClassForColumnKey(column.key)">
              @if (isArray(element[column.key])) {
                @if (tableUtilsService.isLink(column.key)) {
                  <div
                    [ngClass]="
                      element[column.key].length > 1 ? 'realm-list' : 'realm'
                    ">
                    @for (
                      realm of element[column.key];
                      track realm;
                      let idx = $index
                    ) {
                      <a attr.aria-label="{{ column.label }} Link" href="#">
                        {{ realm }} </a
                      ><br style="margin-top: 3px" />
                    }
                  </div>
                } @else if (onClickHandlerOf(column.key) !== null) {
                  <div
                    [ngClass]="
                      element[column.key].length > 1 ? 'realm-list' : 'realm'
                    ">
                    @for (
                      realm of element[column.key];
                      track realm;
                      let idx = $index
                    ) {
                      <a
                        attr.aria-label="{{ column.label }} Link"
                        (click)="onClickHandlerOf(column.key)?.(element)">
                        {{ realm }} </a
                      ><br style="margin-top: 3px" />
                    }
                  </div>
                } @else {
                  <div
                    [ngClass]="
                      element[column.key].length > 1 ? 'realm-list' : 'realm'
                    ">
                    @for (
                      realm of element[column.key];
                      track realm;
                      let idx = $index
                    ) {
                      <span
                        [ngClass]="
                          tableUtilsService.getClassForColumn(
                            column.key,
                            element
                          )
                        ">
                        {{
                          tableUtilsService.getDisplayText(column.key, element)
                        }}
                      </span>
                      ><br style="margin-top: 3px" />
                    }
                  </div>
                }
              } @else {
                @if (tableUtilsService.isLink(column.key)) {
                  <a
                    [ngClass]="
                      tableUtilsService.getClassForColumn(column.key, element)
                    "
                    attr.aria-label="{{ column.label }} Link"
                    href="#">
                    {{ element[column.key] }}
                  </a>
                } @else if (onClickHandlerOf(column.key) !== null) {
                  <a
                    [ngClass]="
                      tableUtilsService.getClassForColumn(column.key, element)
                    "
                    attr.aria-label="{{ column.label }} Link"
                    (click)="onClickHandlerOf(column.key)?.(element)">
                    {{ element[column.key] }}
                  </a>
                } @else {
                  <span
                    [ngClass]="
                      tableUtilsService.getClassForColumn(column.key, element)
                    ">
                    {{ tableUtilsService.getDisplayText(column.key, element) }}
                  </span>
                }
              }
            </div>
          </ng-container>
        </td>
      </ng-container>
    }

    <tr
      *matHeaderRowDef="displayedColumns"
      aria-label="Header Row"
      mat-header-row></tr>
    <tr
      *matRowDef="let row; columns: displayedColumns"
      aria-label="Data Row"
      mat-row></tr>
    <tr *matNoDataRow aria-label="No Data Row">
      <td [attr.colspan]="displayedColumns.length" aria-label="No Data Cell">
        No data matching the filter.
      </td>
    </tr>
  </table>
</div>
