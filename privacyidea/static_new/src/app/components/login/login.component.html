<!--
 (c) NetKnights GmbH 2025,  https://netknights.it

 This code is free software; you can redistribute it and/or
 modify it under the terms of the GNU AFFERO GENERAL PUBLIC LICENSE
 as published by the Free Software Foundation; either
 version 3 of the License, or any later version.

 This code is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 GNU AFFERO GENERAL PUBLIC LICENSE for more details.

 You should have received a copy of the GNU Affero General Public
 License along with this program.  If not, see <http://www.gnu.org/licenses/>.

 SPDX-License-Identifier: AGPL-3.0-or-later
-->
<div
  aria-label="Login Container"
  class="login-container"
  i18n-aria-label>
  <div class="login-scroll">
    <img
      alt="logo"
      aria-label="Logo"
      class="logo"
      height="307"
      i18n-alt
      i18n-aria-label
      ngSrc="assets/privacyIDEA1.png"
      ngSrcset="1x"
      sizes="(max-width: 307px) 100vw, 307px"
      width="307" />

    <img
      alt="logo-text"
      aria-label="Logo Text"
      class="logo-text"
      height="109"
      i18n-alt
      i18n-aria-label
      ngSrc="assets/logo-text.png"
      ngSrcset="1x"
      sizes="(max-width: 575px) 100vw, 575px"
      width="575" />

    <div class="margin-top-64">
      {{ loginText() }}
    </div>

    <form
      (ngSubmit)="onSubmit()"
      aria-label="Login Form"
      class="login-form"
      i18n-aria-label>
      @if (loginMessage().length > 0) {
        <div class="login-message">
          @for (msg of loginMessage(); track msg) {
            <p class="login-message-header">{{ msg }}</p>
          }
        </div>
      }
      @if (errorMessage()) {
        <div class="error-message">
          <p>{{ errorMessage() }}</p>
        </div>
      }

      @if (realms().length > 0) {
        <mat-form-field>
          <mat-label>Realm</mat-label>
          <mat-select
            [(ngModel)]="realm"
            [ngModelOptions]="{ standalone: true }"
            [value]="realm()">
            @for (realmOption of realms(); track realmOption) {
              <mat-option [value]="realmOption">{{ realmOption }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      }

      @if (realms().length > 0) {
        <mat-form-field>
          <mat-label>Realm</mat-label>
          <mat-select
            [(ngModel)]="realm"
            [ngModelOptions]="{ standalone: true }"
            [value]="realm()">
            @for (realmOption of realms(); track realmOption) {
              <mat-option [value]="realmOption">{{ realmOption }}</mat-option>
            }
          </mat-select>
          @if (realm() !== "") {
            <app-clear-button
              matSuffix
              (onClick)="clearRealmSelection()"></app-clear-button>
          }
        </mat-form-field>
      }

      @if (!showOtpField()) {
        <mat-form-field appearance="outline">
          <mat-label i18n="Login username label">Username</mat-label>
          <input
            [(ngModel)]="username"
            id="username"
            matInput
            name="username"
            required
            type="text" />
        </mat-form-field>
      }

      @if (!showOtpField()) {
        <mat-form-field appearance="outline">
          <mat-label i18n="Login password label">Password</mat-label>
          <input
            [(ngModel)]="password"
            id="password"
            matInput
            name="password"
            required
            type="password" />
        </mat-form-field>
      }

      @if (showOtpField()) {
        <mat-form-field appearance="outline">
          <mat-label i18n="Login OTP label">One-Time-Password</mat-label>
          <input
            #otpInput
            [(ngModel)]="otp"
            id="otp"
            matInput
            name="otp"
            required
            autocomplete="one-time-code"
            type="text" />
        </mat-form-field>
      }

      <div class="login-actions margin-top-1">
        <button
          [disabled]="isLoginButtonDisabled()"
          aria-label="Login Button"
          class="login-btn"
          extended
          i18n-aria-label
          mat-fab
          type="submit">
          <span i18n="Login button text">Log In</span>
          <mat-icon iconPositionEnd>login</mat-icon>
        </button>

        @if (showOtpField()) {
          <button
            (click)="resetLogin()"
            i18n-aria-label
            aria-label="Start Over"
            class="reset-btn"
            extended
            mat-fab
            type="button">
            <span i18n="Reset button text">Reset</span>
            <mat-icon iconPositionEnd>replay</mat-icon>
          </button>
        }
      </div>

      @if (webAuthnTriggered()) {
        <button
          (click)="webAuthnLogin()"
          i18n-aria-label
          aria-label="WebAuthn Button"
          class="reset-btn margin-top-1"
          extended
          mat-fab
          type="button">
          <span i18n="WebAuthn button text">WebAuthn</span>
          <mat-icon iconPositionEnd>key</mat-icon>
        </button>
      }
    </form>
    @if (!showOtpField()) {
      <div class="passkey-form">
        <button
          (click)="passkeyLogin()"
          i18n-aria-label
          aria-label="Passkey Button"
          class="passkey-btn margin-top-1"
          extended
          mat-fab
          type="submit">
          <span i18n="Passkey button text">Log In With Passkey</span>
          <mat-icon iconPositionEnd>key</mat-icon>
        </button>
      </div>
    }
  </div>
</div>
